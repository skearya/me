---
import { getAnimeList, getMangaList } from "./lists";
import Item from "./Item.astro";

function getMalClientId(): string {
	try {
		return Astro.locals.runtime.env.MAL_CLIENT_ID;
	} catch {
		return import.meta.env.MAL_CLIENT_ID;
	}
}

const MAL_CLIENT_ID = getMalClientId();

const [animeList, mangaList] = await Promise.all([
	getAnimeList(MAL_CLIENT_ID),
	getMangaList(MAL_CLIENT_ID),
]);
---

<section class="overflow-hidden rounded-lg border">
	<div class="flex h-12 items-stretch justify-stretch divide-x border-b">
		<button
			id="anime-selector"
			class="selected w-full hover:bg-moonlightFocusMedium"
		>
			<h1>anime</h1>
		</button>
		<button
			id="manga-selector"
			class="w-full hover:bg-moonlightFocusMedium"
		>
			<h1>manga</h1>
		</button>
	</div>
	<div id="anime" class="h-[34rem] divide-y overflow-y-scroll">
		{animeList.map((anime) => <Item item={anime} />)}
	</div>
	<div id="manga" class="hidden h-[34rem] divide-y overflow-y-scroll">
		{mangaList.map((manga) => <Item item={manga} />)}
	</div>
</section>

<style>
	.selected {
		@apply bg-moonlightFocusHigh;
	}
</style>

<script>
	const animeSelector = document.getElementById("anime-selector")!;
	const mangaSelector = document.getElementById("manga-selector")!;
	const anime = document.getElementById("anime")!;
	const manga = document.getElementById("manga")!;

	animeSelector.addEventListener("click", () => {
		animeSelector.classList.add("selected");
		mangaSelector.classList.remove("selected");
		anime.classList.remove("hidden");
		manga.classList.add("hidden");
	});
	mangaSelector.addEventListener("click", () => {
		mangaSelector.classList.add("selected");
		animeSelector.classList.remove("selected");
		manga.classList.remove("hidden");
		anime.classList.add("hidden");
	});
</script>
